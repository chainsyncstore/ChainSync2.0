{
  "meta": {
    "project": "ChainSync",
    "date": "2025-08-17",
    "prepared_by": "Generated by TestSprite"
  },
  "product_overview": "ChainSync is a comprehensive multi-store Point of Sale (POS) and inventory management platform designed to unify checkout processes, real-time analytics, and centralized administration across multiple retail locations. Supporting offline-first operation, barcode scanning, inventory control, subscription billing, and optional AI-driven forecasting, ChainSync streamlines retail management workflows for store owners and managers.",
  "core_goals": [
    "Provide a reliable POS system with idempotent sales recording and accurate inventory management",
    "Offer real-time dashboards, alerts, and analytics for multiple roles including admins, managers, and cashiers",
    "Support multi-store operations with role-based access control and centralized visibility",
    "Enable seamless data import/export using CSV templates for inventory and products",
    "Implement subscription and billing management with regional payment providers (Paystack, Flutterwave)",
    "Ensure robust security compliance including session management, CSRF protection, IP whitelisting, and audit logs",
    "Support offline synchronization of sales and inventory data with conflict resolution",
    "Optionally integrate AI-powered insights and demand forecasting with feature flags"
  ],
  "key_features": [
    "POS and Checkout System supporting barcode scanning, cart management, discounts, taxes, and multiple payment methods",
    "Comprehensive Inventory Management with CRUD operations, per-store stock tracking, low-stock alerts, and CSV import/export capabilities",
    "Multi-Store Administration with role-based user permissions for admins, managers, and cashiers",
    "Customer Loyalty program supporting customer profiles, tiered points system, and transaction ledger",
    "Subscription and Billing functionality managing tiered plans, trials, payments, webhooks with signature verification, and dunning pipelines",
    "Offline Sync APIs for uploading/downloading offline batch data, monitoring sync status, and resolving conflicts",
    "Observability tools including health checks, system metrics, security events, and performance analytics",
    "Security features like session cookies, CSRF protection, rate limits, CSP policies, IP whitelisting, and audit logging",
    "AI-powered features offering chat-based queries, insights cards, and forecasting models controlled by configuration flags"
  ],
  "user_flow_summary": [
    "User signup initiating trial with optional upfront fee logic and email/phone verification",
    "User login with optional IP whitelist enforcement after authentication",
    "POS checkout flow: cashier scans items, applies discounts, processes payments, and receives receipts while inventory updates in real time",
    "Manager dashboard viewing store-level alerts, sales trends, and managing inventory thresholds",
    "Admin onboarding stores, assigning user roles and permissions, and managing billing and subscription plans",
    "Subscription billing flow handling payments, webhook events, and dunning for past due accounts",
    "Offline synchronization involving upload/download of offline sales and inventory data with conflict resolution mechanisms"
  ],
  "validation_criteria": [
    "Idempotent sales recording verified by rejecting duplicate sales with identical idempotency keys",
    "Accurate inventory decrement per completed sales transaction",
    "CSV imports validate schema strictly and reject malformed rows with clear error messages",
    "Role-based access controls enforce permission boundaries returning 403 for unauthorized access",
    "Loyalty points system accurately increments and prevents overdrawing on redemption",
    "Subscription webhook events require valid signatures and return idempotent responses for duplicates",
    "Health checks and observability endpoints report database latency and system health accurately",
    "Security mechanisms including CSRF, session cookies, rate limits, and IP whitelisting operate as intended",
    "AI routes and features are only registered and accessible when feature-flag enabled"
  ],
  "code_summary": {
    "tech_stack": [
      "TypeScript",
      "Express",
      "Vite (React)",
      "Drizzle ORM",
      "PostgreSQL",
      "Redis",
      "Vitest",
      "Playwright"
    ],
    "features": [
      {
        "name": "Auth",
        "description": "Signup, login, logout, CSRF token, 2FA setup/verify, session-based auth.",
        "files": [
          "server/api/index.ts",
          "server/api/routes.auth.ts",
          "server/schemas/auth.ts",
          "server/session.ts"
        ],
        "api_doc": {
          "openapi": "3.0.0",
          "info": {
            "title": "Auth API",
            "version": "1.0.0"
          },
          "paths": {
            "/api/auth/signup": {
              "post": {
                "summary": "Validate signup and create pending token",
                "responses": {
                  "200": {
                    "description": "OK"
                  },
                  "400": {
                    "description": "Validation error"
                  }
                }
              }
            },
            "/api/auth/login": {
              "post": {
                "summary": "Login with email/username and password",
                "responses": {
                  "200": {
                    "description": "OK"
                  },
                  "401": {
                    "description": "Invalid credentials"
                  }
                }
              }
            },
            "/api/auth/logout": {
              "post": {
                "summary": "Logout and clear session"
              }
            },
            "/api/auth/csrf-token": {
              "get": {
                "summary": "Get CSRF token cookie"
              }
            },
            "/api/auth/2fa/setup": {
              "post": {
                "summary": "Setup TOTP secret (admin)"
              }
            },
            "/api/auth/2fa/verify": {
              "post": {
                "summary": "Verify TOTP code"
              }
            },
            "/api/auth/forgot-password": {
              "post": {
                "summary": "Request password reset"
              }
            },
            "/api/auth/validate-reset-token/{token}": {
              "get": {
                "summary": "Validate reset token"
              }
            },
            "/api/auth/reset-password": {
              "post": {
                "summary": "Reset password with token"
              }
            },
            "/api/auth/me": {
              "get": {
                "summary": "Get current user"
              }
            }
          }
        }
      },
      {
        "name": "Payment",
        "description": "Initialize and verify payments (Paystack/Flutterwave), generic webhook, signup completion on success.",
        "files": [
          "server/api/routes.payment.ts",
          "server/api/routes.webhooks.ts",
          "server/payment/service.ts"
        ],
        "api_doc": {
          "openapi": "3.0.0",
          "info": {
            "title": "Payment API",
            "version": "1.0.0"
          },
          "paths": {
            "/api/payment/initialize": {
              "post": {
                "summary": "Initialize payment",
                "responses": {
                  "200": {
                    "description": "OK"
                  },
                  "400": {
                    "description": "Validation error"
                  }
                }
              }
            },
            "/api/payment/verify": {
              "post": {
                "summary": "Verify payment by reference",
                "responses": {
                  "200": {
                    "description": "Success"
                  },
                  "400": {
                    "description": "Failed"
                  }
                }
              }
            },
            "/api/payment/webhook": {
              "post": {
                "summary": "Generic webhook ack"
              }
            },
            "/webhooks/paystack": {
              "post": {
                "summary": "Paystack webhook with signature validation"
              }
            },
            "/webhooks/flutterwave": {
              "post": {
                "summary": "Flutterwave webhook with signature validation"
              }
            }
          }
        }
      },
      {
        "name": "Inventory",
        "description": "Inventory CRUD endpoints, stock count, stock movements, CSV import, products list/create.",
        "files": [
          "server/api/routes.inventory.ts",
          "scripts/csv-templates/inventory_import_template.csv"
        ],
        "api_doc": {
          "openapi": "3.0.0",
          "info": {
            "title": "Inventory API",
            "version": "1.0.0"
          },
          "paths": {
            "/api/stores/{storeId}/inventory": {
              "get": {
                "summary": "List inventory by store"
              }
            },
            "/api/stores/{storeId}/inventory/{productId}": {
              "put": {
                "summary": "Update quantity"
              }
            },
            "/api/stores/{storeId}/inventory/bulk-update": {
              "post": {
                "summary": "Bulk quantity updates"
              }
            },
            "/api/stores/{storeId}/inventory/low-stock": {
              "get": {
                "summary": "List low stock items"
              }
            },
            "/api/stores/{storeId}/inventory/stock-movements": {
              "get": {
                "summary": "Stock movements"
              }
            },
            "/api/stores/{storeId}/inventory/stock-count": {
              "post": {
                "summary": "Perform stock count"
              }
            },
            "/api/inventory/products": {
              "get": {
                "summary": "List products"
              },
              "post": {
                "summary": "Create product"
              }
            },
            "/api/inventory/template.csv": {
              "get": {
                "summary": "Download CSV template"
              }
            },
            "/api/inventory/import": {
              "post": {
                "summary": "Import inventory via CSV"
              }
            }
          }
        }
      },
      {
        "name": "Customers",
        "description": "Search and create customers by phone within org scope.",
        "files": [
          "server/api/routes.customers.ts"
        ],
        "api_doc": {
          "openapi": "3.0.0",
          "info": {
            "title": "Customers API",
            "version": "1.0.0"
          },
          "paths": {
            "/api/customers": {
              "get": {
                "summary": "Find by phone"
              },
              "post": {
                "summary": "Create customer"
              }
            }
          }
        }
      },
      {
        "name": "Offline Sync",
        "description": "Upload/download offline sales and inventory updates, status, conflict resolution.",
        "files": [
          "server/api/routes.offline-sync.ts"
        ],
        "api_doc": {
          "openapi": "3.0.0",
          "info": {
            "title": "Offline Sync API",
            "version": "1.0.0"
          },
          "paths": {
            "/api/sync/upload": {
              "post": {
                "summary": "Upload offline batch"
              }
            },
            "/api/sync/download": {
              "get": {
                "summary": "Download data for offline use"
              }
            },
            "/api/sync/status": {
              "get": {
                "summary": "Get sync status"
              }
            },
            "/api/sync/resolve-conflicts": {
              "post": {
                "summary": "Resolve conflicts"
              }
            },
            "/api/sync/health": {
              "get": {
                "summary": "Sync health"
              }
            }
          }
        }
      },
      {
        "name": "Observability",
        "description": "Health, metrics, logs analytics, alerts config, config overview.",
        "files": [
          "server/api/routes.observability.ts"
        ],
        "api_doc": {
          "openapi": "3.0.0",
          "info": {
            "title": "Observability API",
            "version": "1.0.0"
          },
          "paths": {
            "/api/observability/health": {
              "get": {
                "summary": "Health check"
              }
            },
            "/api/observability/metrics": {
              "get": {
                "summary": "System metrics (admin)"
              }
            },
            "/api/observability/security/events": {
              "get": {
                "summary": "Security events (admin)"
              }
            },
            "/api/observability/performance": {
              "get": {
                "summary": "Performance metrics"
              }
            },
            "/api/observability/websocket/stats": {
              "get": {
                "summary": "WebSocket stats"
              }
            },
            "/api/observability/metrics/clear": {
              "post": {
                "summary": "Clear metrics (admin)"
              }
            },
            "/api/observability/logs/analytics": {
              "get": {
                "summary": "Log analytics"
              }
            },
            "/api/observability/alerts/config": {
              "get": {
                "summary": "Alerts config"
              }
            },
            "/api/observability/config": {
              "get": {
                "summary": "System config"
              }
            }
          }
        }
      }
    ]
  }
}
